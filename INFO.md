# VanillaCRM - Исследование проекта

## Общая информация

**VanillaCRM** - это система управления взаимоотношениями с клиентами, построенная на фреймворке Laravel. Проект представляет собой многофункциональную CRM-систему с поддержкой организационной иерархии, управления пользователями, генерации отчетов и интеграции с внешними сервисами.

## Технический стек

### Backend
- **PHP 8.4+** - основной язык программирования
- **Laravel 12.21+** - фреймворк
- **Laravel Sanctum** - аутентификация через API токены
- **GuzzleHTTP** - HTTP клиент для внешних API
- **PHPOffice/PHPSpreadsheet** - работа с Excel файлами

### Frontend
- **Bootstrap 5** - CSS фреймворк
- **jQuery** - JavaScript библиотека
- **Bootstrap Icons** - иконки
- **Slick Carousel** - карусель
- **Vite** - сборка фронтенда

### База данных
- **MariaDB/MySQL** - основная СУБД
- **Redis** - кэширование (опционально)

### Инфраструктура
- **Docker** - контейнеризация
- **Nginx** - веб-сервер
- **PHP-FPM** - обработчик PHP

## Структура проекта

### Модели данных
- **User** - пользователи системы
- **Company** - компании/организации
- **Department** - отделы/департаменты
- **Post** - должности/позиции
- **Permission** - права доступа
- **Field** - пользовательские поля
- **Report** - отчеты
- **Temp** - временные данные

### Контроллеры
- **HomeController** - главный контроллер
- **UserController** - управление пользователями
- **CompanyController** - управление компаниями
- **DepartmentController** - управление отделами
- **PostController** - управление должностями
- **PermissionController** - управление правами
- **FieldController** - управление полями
- **ReportXlsxController** - генерация отчетов XLSX
- **CashierReportController** - отчеты кассиров
- **ExpenseRequestController** - управление запросами расходов
- **ArchiveController** - архив отчетов
- **StatController** - статистика
- **ThemeController** - управление темами
- **ModController** - функции модератора

### Сервисы
- **ReportXlsxService** - сервис для работы с Excel отчетами

### Перечисления (Enums)
- **ReportXlsxRule** - правила генерации отчетов

## Функциональность

### Управление пользователями
- Регистрация и аутентификация
- Управление ролями (admin, user)
- Привязка к компаниям, отделам и должностям
- Кастомные поля пользователей
- Статусы пользователей (активный/неактивный)

### Организационная структура
- Иерархия: Компания → Отдел → Должность → Пользователь
- Гибкая система прав доступа
- Управление несколькими компаниями

### Отчетность
- Генерация отчетов в формате XLSX
- Три типа отчетов: Service, Caffe, Cashier
- Архивация и управление историей отчетов
- Автоматическое создание отчетов за предыдущий месяц

### Интеграции
- **VanillaFlow API** - интеграция с системой управления расходами
- Управление токенами доступа к внешним API
- Экспорт данных в различные форматы

### Административные функции
- Полный контроль над структурой организаций
- Управление правами доступа
- Просмотр статистики и аналитики
- Управление архивами отчетов

## База данных

### Основные таблицы
- **users** - пользователи системы
- **companies** - компании
- **departments** - отделы
- **posts** - должности
- **permissions** - права доступа
- **fields** - пользовательские поля
- **reports** - отчеты
- **temp** - временные данные

### Связи
- Пользователь принадлежит компании, отделу и должности
- Отдел принадлежит компании
- Должность принадлежит компании и отделу
- Отчеты связаны с пользователями и компаниями

## Аутентификация и авторизация

### Уровни доступа
1. **Admin** - полный доступ ко всем функциям
2. **User** - ограниченный доступ в зависимости от прав

### Middleware
- **admin** - проверка прав администратора
- **user** - проверка прав пользователя

## Развертывание

### Локальная разработка
```bash
composer install
npm install
composer run dev
```

### Docker развертывание
```bash
docker-compose up -d
```

Сервисы доступны по портам:
- Приложение: 8002
- MariaDB: 3306
- phpMyAdmin: 8080

## Архитектурные особенности

### Многоуровневая архитектура
1. **Presentation Layer** - Blade шаблоны + JavaScript
2. **Application Layer** - Контроллеры + Сервисы
3. **Domain Layer** - Модели + Бизнес-логика
4. **Infrastructure Layer** - База данных + Внешние API

### Принципы проектирования
- MVC архитектура
- Dependency Injection
- Repository pattern (частично)
- Service layer для бизнес-логики

## Безопасность

### Меры защиты
- Валидация входных данных
- Защита от SQL injection (Eloquent ORM)
- CSRF защита
- XSS защита
- Rate limiting
- HTTPS/SSL поддержка

### Аутентификация
- Сессионная аутентификация для web
- Token-based аутентификация для API (Sanctum)

## Мониторинг и отладка

### Инструменты
- **Laravel Debugbar** - отладка в development
- **PHP_CodeSniffer** - проверка кода
- **PHP-CS-Fixer** - форматирование кода

## Лицензия

**CC BY-NC-ND 4.0** - Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International

## Перспективы развития

### Возможные улучшения
1. **API документация** - Swagger/OpenAPI
2. **Тестирование** - Unit и Feature tests
3. **Кэширование** - Redis для производительности
4. **Очереди** - Laravel Queues для фоновых задач
5. **Уведомления** - Email/SMS уведомления
6. **Мобильное приложение** - React Native/Vue Native

### Интеграции
- Telegram бот для уведомлений
- SMS сервисы для 2FA
- Cloud storage для резервных копий
- Monitoring services (Sentry, Bugsnag)

## Заключение

VanillaCRM представляет собой полнофункциональную CRM-систему с современной архитектурой, поддерживающую сложные организационные структуры, расширенную отчетность и интеграцию с внешними сервисами. Проект хорошо структурирован и готов к дальнейшему развитию и масштабированию.